<div fxLayout="column" fxLayoutGap="16px" style="padding: 16px;">
  
  <!-- KPI Summary Cards -->
  <div fxLayout.xs="column" fxLayout.gt-xs="row" fxLayoutGap="15px">
    <mat-card fxFlex class="kpi-card kpi-total">
      <mat-card-title>Total Activities</mat-card-title>
      <mat-card-content>{{ totalActivities() }}</mat-card-content>
    </mat-card>
    <mat-card fxFlex class="kpi-card kpi-planned">
      <mat-card-title>Planned</mat-card-title>
      <mat-card-content>{{ totalPlanned() }}</mat-card-content>
    </mat-card>
    <mat-card fxFlex class="kpi-card kpi-in-progress">
      <mat-card-title>In Progress</mat-card-title>
      <mat-card-content>{{ totalInProgress() }}</mat-card-content>
    </mat-card>
    <mat-card fxFlex class="kpi-card kpi-overdue">
      <mat-card-title>Overdue</mat-card-title>
      <mat-card-content>{{ totalOverdue() }}</mat-card-content>
    </mat-card>
  </div>

  <!-- Action Bar -->
  <div fxLayout="row" fxLayoutAlign="start center">
    <span fxFlex="1 1 auto"></span>
    <button mat-flat-button (click)="openAddActivityDialog()">
      <mat-icon>add</mat-icon>
      Add Activity
    </button>
  </div>

  <!-- Search and Filters -->
  <div fxLayout="column" fxLayoutGap="16px">
    <!-- Search Bar -->
    <mat-form-field appearance="outline">
      <mat-label>Search activities</mat-label>
      <input matInput [formControl]="searchControl" placeholder="Search by name, description, or status" />
      <button *ngIf="searchControl.value" matSuffix mat-icon-button aria-label="Clear" (click)="searchControl.setValue('')">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>

    <!-- Clear Filters Button -->
    <div fxLayout="row" fxLayoutAlign="end center">
      <button mat-stroked-button (click)="clearFilters()">
        <mat-icon>clear_all</mat-icon>
        Clear Search
      </button>
    </div>
  </div>

  <!-- Debug Information 
  <div style="background: #f5f5f5; padding: 16px; margin: 16px 0; border-radius: 4px;">
    <h4>Debug Info:</h4>
    <p>Activities Count: {{ activities()?.length || 0 }}</p>
    <p>Total Activities: {{ totalActivities() }}</p>
    <p>Is Loading: {{ isLoading() }}</p>
    <p>Error: {{ error() || 'None' }}</p>
    <p>Activities Data: {{ activities() | json }}</p>
  </div>

  Simple Activities List (for debugging) 
  <div *ngIf="activities() && activities().length > 0" style="background: #e8f5e8; padding: 16px; margin: 16px 0; border-radius: 4px;">
    <h4>Raw Activities Data ({{ activities().length }} items):</h4>
    <div *ngFor="let activity of activities(); let i = index" style="border-bottom: 1px solid #ccc; padding: 8px 0;">
      <strong>{{ i + 1 }}. {{ activity.name }}</strong> - {{ activity.status }}
    </div>
  </div>-->

  <!-- Activities Table -->
  <div *ngIf="activities() && activities().length > 0">
    <table mat-table [dataSource]="activities()" class="mat-elevation-z1">
      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Activity Name</th>
        <td mat-cell *matCellDef="let activity">
          <div fxLayout="column" fxLayoutGap="4px">
            <strong>{{ activity.name }}</strong>
            <small style="color: #666;">{{ activity.description }}</small>
          </div>
        </td>
      </ng-container>

      <!-- Description Column -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Description</th>
        <td mat-cell *matCellDef="let activity">
          <span class="description-text">{{ activity.description }}</span>
        </td>
      </ng-container>

      <!-- Scheduled Time Column -->
      <ng-container matColumnDef="scheduledTime">
        <th mat-header-cell *matHeaderCellDef>Scheduled Time</th>
        <td mat-cell *matCellDef="let activity">
          <div fxLayout="column" fxLayoutGap="4px">
            <span>{{ formatDate(activity.scheduledTime) }}</span>
            <small style="color: #666;">{{ formatDateTime(activity.scheduledTime) }}</small>
          </div>
        </td>
      </ng-container>

      <!-- Frequency Column -->
      <ng-container matColumnDef="frequency">
        <th mat-header-cell *matHeaderCellDef>Frequency</th>
        <td mat-cell *matCellDef="let activity">
          <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="8px">
            <mat-icon [matTooltip]="activity.frequency">{{ getFrequencyIcon(activity.frequency) }}</mat-icon>
            <span>{{ activity.frequency }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let activity">
          <span class="status" [ngClass]="getStatusColor(activity.status)">
            {{ activity.status }}
          </span>
        </td>
      </ng-container>

      <!-- Last Completed Column -->
      <ng-container matColumnDef="lastCompleted">
        <th mat-header-cell *matHeaderCellDef>Last Completed</th>
        <td mat-cell *matCellDef="let activity">
          <span *ngIf="activity.lastCompleted; else notCompleted">
            {{ formatDate(activity.lastCompleted) }}
          </span>
          <ng-template #notCompleted>
            <span style="color: #999; font-style: italic;">Never</span>
          </ng-template>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let activity">
          <div fxLayout="row" fxLayoutGap="8px">
            <!-- Status Update Menu -->
            <button mat-icon-button [matMenuTriggerFor]="statusMenu" matTooltip="Update Status">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #statusMenu="matMenu">
              <button mat-menu-item 
                      *ngFor="let status of getStatusOptions()" 
                      (click)="updateActivityStatusWithType(activity.id, status)"
                      [disabled]="status === activity.status">
                <mat-icon>{{ status === activity.status ? 'check' : 'radio_button_unchecked' }}</mat-icon>
                <span>{{ status }}</span>
              </button>
            </mat-menu>

            <!-- Mark as Completed -->
            <button mat-icon-button 
                    (click)="markActivityCompleted(activity.id)"
                    matTooltip="Mark as Completed"
                    *ngIf="activity.status !== 'Completed'">
              <mat-icon>check_circle</mat-icon>
            </button>

            <!-- Delete -->
            <button mat-icon-button 
                    (click)="deleteActivity(activity.id)"
                    matTooltip="Delete Activity"
                    color="warn">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <!-- No Data Message -->
  <div *ngIf="!isLoading() && (!activities() || activities().length === 0)" style="text-align: center; padding: 40px; color: #666;">
    <mat-icon style="font-size: 48px; width: 48px; height: 48px; color: #ccc;">event_busy</mat-icon>
    <h3>No Activities Found</h3>
    <p>There are no activities to display at the moment.</p>
    <p>Try adding a new activity or check your filters.</p>
  </div>



  <!-- Loading and Error States -->
  @if (isLoading()) {
    <mat-progress-bar mode="query"></mat-progress-bar>
  }

  @if (error()) {
    <div class="error-message">
      <mat-icon>error</mat-icon>
      {{ error() }}
      <button mat-button (click)="clearError()">Dismiss</button>
    </div>
  }
</div>
