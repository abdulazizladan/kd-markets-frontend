<div fxLayout="column" fxLayoutGap="16px" style="padding: 16px;">
  
  <div fxLayout.xs="column" fxLayout.gt-xs="row" fxLayoutGap="15px">
    <mat-card fxFlex class="kpi-card kpi-total">
      <mat-card-title>Total markets</mat-card-title>
      <mat-card-content>{{ totalMarkets }}</mat-card-content>
    </mat-card>
    <mat-card fxFlex class="kpi-card kpi-shops">
      <mat-card-title>Total shops</mat-card-title>
      <mat-card-content>{{ totalShops }}</mat-card-content>
    </mat-card>
    <mat-card fxFlex class="kpi-card kpi-stalls">
      <mat-card-title>Total stalls</mat-card-title>
      <mat-card-content>{{ totalStalls }}</mat-card-content>
    </mat-card>
    <mat-card fxFlex class="kpi-card kpi-buildings">
      <mat-card-title>Total buildings</mat-card-title>
      <mat-card-content>{{ totalBuildings }}</mat-card-content>
    </mat-card>
  </div>

  <div fxLayout.xs="column" fxLayout.gt-xs="row" fxLayoutGap="15px">
    
  </div>

    <div fxLayout="row" fxLayoutAlign="start center">
        <span fxFlex="1 1 auto"></span>
        <button mat-flat-button (click)="openAddMarketDialog()">
        <mat-icon>add</mat-icon>
        Add market
        </button>
    </div>

    <mat-form-field appearance="outline">
        <mat-label>Search markets</mat-label>
        <input matInput [formControl]="searchControl" placeholder="Search by name, id, or address" />
        <button *ngIf="searchControl.value" matSuffix mat-icon-button aria-label="Clear" (click)="searchControl.setValue('')">
        <mat-icon>close</mat-icon>
        </button>
    </mat-form-field>

    <table mat-table [dataSource]="markets()" class="mat-elevation-z1">
        <!-- ID Column -->
        <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let m">{{ m.id }}</td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let m">{{ m.name }}</td>
        </ng-container>

        <!-- Street Address Column -->
        <ng-container matColumnDef="streetAddress">
        <th mat-header-cell *matHeaderCellDef>Street</th>
        <td mat-cell *matCellDef="let m">{{ m.address?.streetAddress }}</td>
        </ng-container>

        <!-- Town Column -->
        <ng-container matColumnDef="town">
        <th mat-header-cell *matHeaderCellDef>Town</th>
        <td mat-cell *matCellDef="let m">{{ m.address?.town }}</td>
        </ng-container>

        <!-- LGA Column -->
        <ng-container matColumnDef="lga">
        <th mat-header-cell *matHeaderCellDef>LGA</th>
        <td mat-cell *matCellDef="let m">{{ m.address?.lga }}</td>
        </ng-container>

        <!-- State Column -->
        <ng-container matColumnDef="state">
        <th mat-header-cell *matHeaderCellDef>State</th>
        <td mat-cell *matCellDef="let m">{{ m.address?.state }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

  @if (isLoading()) {
    <mat-progress-bar mode="query"></mat-progress-bar>
  }
  @if (error()) {
    <div class="error">{{ error() }}</div>
  }

  @if (!isLoading() && markets().length === 0) {
    <div>No markets found.</div>
  }
</div>
