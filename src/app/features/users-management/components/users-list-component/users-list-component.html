<div fxLayout="column" fxLayoutGap="16px" style="padding: 16px;">
    <div fxLayout="row" fxLayoutAlign="start center">
        <span fxFlex="1 1 auto"></span>
        <button mat-flat-button (click)="openAddUserDialog()">
            <mat-icon>
                add
            </mat-icon>
            Add user
        </button>
    </div>

  <mat-form-field appearance="outline">
    <mat-label>Search users</mat-label>
    <input matInput [formControl]="searchControl" placeholder="Search by name, email, role, status, phone" />
    <button *ngIf="searchControl.value" matSuffix mat-icon-button aria-label="Clear" (click)="searchControl.setValue('')">
      <mat-icon>close</mat-icon>
    </button>
  </mat-form-field>

  <table mat-table [dataSource]="users()" class="mat-elevation-z1">
    <!-- ID Column -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef>ID</th>
      <td mat-cell *matCellDef="let user">{{ user.id }}</td>
    </ng-container>

    <!-- Name Column -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Name</th>
      <td mat-cell *matCellDef="let user">{{ user.info?.firstName }}</td>
    </ng-container>

    <!-- Email Column -->
    <ng-container matColumnDef="email">
      <th mat-header-cell *matHeaderCellDef>Email</th>
      <td mat-cell *matCellDef="let user">{{ user.email }}</td>
    </ng-container>

    <!-- Role Column -->
    <ng-container matColumnDef="role">
      <th mat-header-cell *matHeaderCellDef>Role</th>
      <td mat-cell *matCellDef="let user">{{ user.role }}</td>
    </ng-container>

    <!-- Status Column -->
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Status</th>
      <td mat-cell *matCellDef="let user">{{ user.status }}</td>
    </ng-container>

    <!-- Phone Column -->
    <ng-container matColumnDef="phone">
      <th mat-header-cell *matHeaderCellDef>Phone</th>
      <td mat-cell *matCellDef="let user">{{ user.contact?.phone }}</td>
    </ng-container>

    <!-- CreatedAt Column -->
    <ng-container matColumnDef="createdAt">
      <th mat-header-cell *matHeaderCellDef>Created</th>
      <td mat-cell *matCellDef="let user">{{ user.createdAt | date: 'mediumDate' }}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>

  @if (isLoading()) {
    <mat-progress-bar mode="query"></mat-progress-bar>
  }
  @if (error()) {
    <div class="error">{{ error() }}</div>
  }

  @if (!isLoading() && users().length === 0) {
    <div>No users found.</div>
  }
</div>
